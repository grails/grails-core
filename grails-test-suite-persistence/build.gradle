configurations.testCompileClasspath {
    exclude module: "grails-plugin-testing"
}

dependencies {
    testImplementation project(':grails-test-suite-base'),
                project(':grails-plugin-domain-class'),
                project(':grails-plugin-datasource'),
                project(':grails-plugin-i18n'),
                project(':grails-plugin-url-mappings'),
                project(':grails-plugin-databinding'),
                project(':grails-plugin-services'),
                project(':grails-plugin-controllers'),
                project(':grails-bootstrap'),
                project(':grails-spring')

    testImplementation "org.grails:grails-datastore-gorm-validation"
    testImplementation "org.grails:grails-datastore-gorm-hibernate5"

    api "org.apache.tomcat:tomcat-jdbc"

    testRuntimeOnly "com.h2database:h2"

    //    // Required for AspectJ support
    testRuntimeOnly "org.springframework:spring-aspects"
    testRuntimeOnly "org.aspectj:aspectjrt", "org.aspectj:aspectjweaver"

    testImplementation "org.grails.plugins:async"
    testImplementation "org.grails:grails-gorm-testing-support"
}

test {
    maxParallelForks = 2
    forkEvery = isCiBuild ? 25 : 100
    if(!isCiBuild) {
        maxHeapSize = '2048m'
    }
    excludes = ['**/GrailsDomainBinderTests.class',
                '**/ComponentValidationTests.class',
                '**/HibernateMappingUniqueConstraintTests.class']
}

task testGrailsDomainBinder(type: Test) { includes = [
        '**/GrailsDomainBinderTests.class'
    ] }


task testIsolatedPersistentOne(type: Test) {
    includes = ['**/ComponentValidationTests.class']
    includes = ['**/HibernateMappingUniqueConstraintTests.class']
}

test.dependsOn testGrailsDomainBinder, testIsolatedPersistentOne
